<!DOCTYPE html>
<html>
    <head>
        <title>MesengerService test page</title>
        </head>
    <body>
        <pre id="output"></pre>
    </body>
<script>
    var output = document.getElementById("output");
    var socket = new WebSocket("ws://localhost:8080/MessengerService")
    socket.onopen = onOpen
    socket.onmessage= onMessage

    function onOpen() {
        output.innerHTML += "Status: connected to MessengerService\n";
    };

    function onMessage(e) {
        let message = JSON.parse(e.data)
        switch(message.action){
            case "UpdateEncryptKey":
                output.innerHTML += `My new Key to encrypting is ${JSON.stringify(message.Key)}\n`
                break;
            default:
                output.innerHTML += "Unexpected Message\n"+ JSON.stringify(message)+"\n";
        }
    }


    function waitForSocketConnection(socket, callback){
        setTimeout(
            function () {
                if (socket.readyState === 1) {
                    if (callback != null){
                        callback();
                    }
                } else {
                    waitForSocketConnection(socket, callback);
                }

            }, 5); // wait 5 milisecond for the connection...
        }
</script>
</html>